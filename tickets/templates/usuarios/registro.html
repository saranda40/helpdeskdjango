{% extends "base_auth.html" %}

{% block title %}Registro{% endblock %}

{% block content %}
    {% if error %}
    {% include "componentes/error.html" with error=error clase="text-bg-danger" %}
    {% endif %}
    {% include "componentes/titulo.html" with titulo=titulo clase="text-primary" %}
    {% include "componentes/subtitulo.html" with message=message clase="text-primary" %}
    <main>
    <form method="post" action="{% url 'Registro Page' %}">
        {% csrf_token %}
        {% for field in form %}
            <div class="mb-3">
                <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                {{ field }}
                {% if field.errors %}
                    <div class="text-danger">
                        {% for error in field.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        {% endfor %}
        <button type="submit" class="btn btn-primary w-100">Crear Cuenta</button>
    </form>
    <div class="text-center mt-3">
        <a href="{% url 'Login Page' %}">¿Ya tienes cuenta? Inicia sesión</a>
    </div>
</main>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    // Escucha cuando cambia la selección en el campo 'Área'
    $("#id_id_area").change(function() {
        var id_area = $(this).val();
        // Si se selecciona un área válida
        if (id_area) {
            // Realiza la llamada AJAX a la URL que creaste
            $.ajax({
                url: "{% url 'get_cargos_por_area' %}",
                data: {
                    'id_area': id_area
                },
                dataType: 'json',
                success: function(data) {
                    console.log(data);
                    var cargos_select = $("#id_id_cargo");
                    cargos_select.empty(); // Limpia las opciones existentes
                    cargos_select.append('<option value="">Selecciona tu cargo</option>');

                    // Itera sobre los datos recibidos y añade una nueva opción para cada usuario
                    $.each(data, function(key, value) {
                        console.log(value.cargo)
                        cargos_select.append('<option value="' + value.id + '">' + value.cargo + '</option>');
                    });
                },
                error: function() {
                    console.error("Error al cargar los cargos.");
                }
            });
        } else {
            // Si no se selecciona un área, limpia el select de usuarios
            $("#id_cargo").empty();
            $("#id_cargo").append('<option value="">Seleccione Cargo</option>');
        }
    });
});
</script>
{% endblock %}